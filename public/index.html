<!DOCTYPE html>
<html lang="1.1">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Can of Mysteries</title>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1049749345591002"
        crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-analytics.js"></script>
        <meta name="google-signin-scope" content="profile email">
        <meta name="google-signin-client_id" content="188291999968-v7rdgm2p73bkdqis7h8a5209na92gsbh.apps.googleusercontent.com">
        <script src="https://apis.google.com/js/platform.js" async defer></script>
        <style>
            @media(min-width: 900px){
                .body-wrapper{
                    grid-template:  
                        "account search search search" 
                        "account left slider right"
                        "account left center  right"
                        "footer footer footer footer";
                    grid-template-rows: 0px 350px auto auto ;
                    grid-template-columns: .5fr 200px auto 200px;
                }
            }
        </style>
    </head>
    <body>
        <div class = "main-wrapper">
            <div class = "upload-container">
                <div class = "upload-form-wrapper">
                    <h1>Article Upload</h1>
                    <i class="fa fa-close" style="font-size:24px"></i>
                    <textarea id="htmeditor"></textarea> <script src="https://htmeditor.com/js/htmeditor.min.js"      htmeditor_textarea="htmeditor"      full_screen="no"      editor_height="480"     run_local="no"> </script> 
                    <form>
                        <div class = "form-row">
                        <div class="form-group col-md-6">
                            <label for="inputFirstName">Author First Name</label>
                            <input type="text" class="form-control" id="inputFirstName" placeholder="First name">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="inputLastName">Author Last Name</label>
                            <input type="text" class="form-control" id="inputLastName" placeholder="Last name">
                        </div>
                        </div>
                        <div class="form-group col-md-12">
                            <label for="inputtitle">Article title</label>
                            <input type="text" class="form-control" id="inputtitle" placeholder="title" required="true">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="descriptionTextArea">Example textarea</label>
                            <textarea class="form-control" id="descriptionTextArea" rows="5" required="true"></textarea>
                        </div>
                        <div class = "form-row">
                            <div class="form-group col-md-6">
                            <label for="inputTag1">Tags - Seperate each tag by 1 comma with no spaces</label>
                            <input type="text" class="form-control" id="inputTag1" placeholder="Tag" required="true">
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="inputCanItem">Can Item</label>
                            <input type="text" class="form-control" id="inputCanItem" placeholder="Can Item" required="true">
                        </div>
                        <div class="form-group col-md-12">
                            <label for="inputCoverImage">Cover Image Link</label>
                            <input type="text" class="form-control" id="inputCoverImage" placeholder="URL" required="true">
                        </div>
                        <button type="submit" class="btn btn-primary" id="articleSubmitBtn">Submit</button>
                    </form>            
                </div>
            </div>
            <div class = "navbar-wrapper">
                <div id = "navbar-top"> 
                    <nav class="navbar navbar-expand-custom navbar-mainbg">
                        <button class="navbar-toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="fas fa-bars text-white"></i>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-auto">
                                <div class="hori-selector"><div class="left"></div><div class="right"></div></div>
                                <li class="nav-item">
                                    <a class="nav-link" href="index.html">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="ourProject.html">Our Project</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="theAssignment.html">The Assignment</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="javascript:void(0);">The Can and its Mysteries contents</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="javascript:void(0);">Using our work as a Resource (Citations)</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="javascript:void(0);">Documents</a>
                                </li>
                            </ul>
                            <svg class="ham ham6" viewBox="0 0 100 100" width="80" onclick="this.classList.toggle('active');">
                                <path
                                    class="line top"
                                    d="m 30,33 h 40 c 13.100415,0 14.380204,31.80258 6.899646,33.421777 -24.612039,5.327373 9.016154,-52.337577 -12.75751,-30.563913 l -28.284272,28.284272" />
                                <path
                                    class="line middle"
                                    d="m 70,50 c 0,0 -32.213436,0 -40,0 -7.786564,0 -6.428571,-4.640244 -6.428571,-8.571429 0,-5.895471 6.073743,-11.783399 12.286435,-5.570707 6.212692,6.212692 28.284272,28.284272 28.284272,28.284272" />
                                <path
                                    class="line bottom"
                                    d="m 69.575405,67.073826 h -40 c -13.100415,0 -14.380204,-31.80258 -6.899646,-33.421777 24.612039,-5.327373 -9.016154,52.337577 12.75751,30.563913 l 28.284272,-28.284272" />
                            </svg>
                        </div>
                    </nav>
                </div>
                <div id = "search-br" class="no-stick">
                    <form class="d-flex input-group srch">
                        <input type="search" class="form-control" placeholder="Search" aria-label="Search" aria-describedby="search-addon" />
                        <span class="input-group-text" id="search-addon">
                            <span style="color: rgb(131, 127, 127)" class="glyphicon glyphicon-search icon-search"></span>
                        </span> 
                    </form>
                    <div class="google g-signin2" data-onsuccess="onSignIn" data-width="200" data-height="35"  data-theme="dark" style="position: relative; left: -150px; margin-top: -75px; float: right;"></div>
                </div>  
            </div>
            <div class = "body-wrapper" id="home-body-wrapper">
                <div class="header-container">
                    <div id="header">
                        <h1 id = "header-title">Can of Mysteries</h1>
                        <p>Read and search for creative articles that examin the many cases <br> mysterious topics that can all be found <a>in the mysterious contents</a> page. <br>  <span>Created and maintained by USCA teachers and students.</span></p>
                        <span><br><i>Searching For:</i></span>
                    </div>
                </div>
                <aside class = "account-container"  id = "account-container-animation">
                    <div id = account-user-container>
                        <div id = "user-icon">
                        </div>
                        <span id="username">Austin Walter</span>
                    </div>
                    <div id = "account-settings-container">
                        <a>
                        <i id="sett-icon" class="material-icons">settings</i>
                        <span id="settings">Settings</span>
                        </a>
                    </div>
                    <div id = "account-upload-container">
                        <a href="">
                        <i id="Upload-icon" class="glyphicon glyphicon-upload"></i>
                        <span id="upload">Upload</span>
                        </a>
                    </div>
                    <div id = "account-admin-container">
                        <a href="">
                        <i id="admin-icon" class="fa fa-file-o"></i>
                        <span id="admin">Admin</span>
                        </a>
                    </div>
                </aside>
                <div id = "grid-text-box">
                    <span id = "text-descrip-grid"></span>
                </div>
                <div class = "archives">
                    <h1>Archives</h1>
                    <br>
                    <ul>
                        <li>test</li>
                    </ul>
                </div>
                <div class = "suggestions">
                    <Span>Most Liked</Span>
                    <div class="suggestion-likes" id ="suggestion-likes:0" onClick="reply_click(this.id)">
                        <a >
                            <img id="suggestion-likes-image" src="https://picsum.photos/190/190?11" />
                            <span id="suggestion-likes-author">Austin Walter</span>
                            <span id="suggestion-likes-date">01.16.2022</span>
                            <span id="suggestion-likes-title">This is an Example Title</span>
                        </a>
                    </div>

                </div>
                <div class="myGallery">
                    <div class="item" id ="item:0" onClick="reply_click(this.id)">
                        <a >
                            <img id="item-image" src="https://picsum.photos/190/190?11" />
                            <span id="author">Austin Walter</span>
                            <span id="date">01.16.2022</span>
                            <span id="title">This is an Example Title</span>
                            <span id="description">This is an Example description, and if you are seing this it means that the description of the article is missing, the article is missing, or the page is under development.</span>
                            <ul id="item-tag-ul">
                                <li id="item-CanItem"></li>
                            </ul>
                        </a>
                    </div>
                </div>
                <div class = "footer-wrapper">
                    <div id = "ftr-left">
                    </div >
                    <div id = "ftr-center">
                        <div id = "cntr-ftr-title">
                        <h1> About Us</h1>
                        </div>
                        <div id = "cntr-ftr-content">
                            The world is a mysterious place. The can of mystery highlights some of those mysteries. This site is a class project for Amanda Warren's English 101 class at the University of South Carolina Aiken. Articles are uploaded once a year (on average) in the fall and/or spring. If you have questions or tips on mysteries, please leave a comment or contact AmandaW at USCA dot EDU.
                        </div>
                    </div>
                    <div id = "ftr-right">
                    </div>
                </div>
            </div>
            <div class = "bookshelf-loader">
                <div class="bookshelf_wrapper">
                    <ul class="books_list">
                      <li class="book_item first"></li>
                      <li class="book_item second"></li>
                      <li class="book_item third"></li>
                      <li class="book_item fourth"></li>
                      <li class="book_item fifth"></li>
                      <li class="book_item sixth"></li>
                    </ul>
                    <div class="shelf"></div>
                  </div>
            </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TweenMax.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.0.5/gsap.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TimelineLite.min.js"></script>
        <script src="js/script.js"></script>
        <script>     
        
            const firebaseConfig = {
                apiKey: "AIzaSyCFUz4czbiLnuA7M7TBVX-iECvKutd8emY",
                authDomain: "main-blog-17ac9.firebaseapp.com",
                projectId: "main-blog-17ac9",
                storageBucket: "main-blog-17ac9.appspot.com",
                messagingSenderId: "188291999968",
                appId: "1:188291999968:web:0a0a6547af55693f270885",
                measurementId: "G-N1ZFZZ7BQT"
            };
            firebase.initializeApp(firebaseConfig);

            let blogPosts = [];

            firebase.firestore().collection('blog-posts').get().then((snapshot) => { 

                snapshot.docs.forEach(doc => {
                    blogPosts .push({ ...doc.data() });
                })

                for(let i = 0; i < blogPosts .length; i++){
                    let gallery = document.getElementsByClassName('myGallery');
                    let div = document.getElementsByClassName('item');
                    let clone = div[0].cloneNode(true);
                    if(i == 0){
                        document.querySelector("span#author").textContent = blogPosts[blogPosts.length-1].author;
                        document.querySelector("span#date").textContent = blogPosts[blogPosts.length-1].date;
                        document.querySelector("span#title").textContent = blogPosts[blogPosts.length-1].title;
                        document.querySelector("span#description").textContent = blogPosts[blogPosts.length-1].description;
                        document.querySelector("img#item-image").src = blogPosts[blogPosts.length-1].coverImage;
                        document.querySelector("li#item-CanItem").innerHTML = blogPosts[blogPosts.length-1].canItem;

                        var tags = (blogPosts[blogPosts.length-1].tag1).split(",");
                        var itemTagUl = document.getElementById("item:0").firstElementChild.childNodes[11]

                        for(var j = 0; j < tags.length; j++){
                             let li = document.createElement("li")
                             li.textContent = tags[j];
                             li.id = "item-tag-li"
                             itemTagUl.append(li);
                        }

                        
                        document.getElementById('item:0').style.height = "min-content";

                    }else{

                        cloneId = "item:" + i;
                        clone.id = cloneId;



                        clone.firstElementChild.childNodes[11].textContent = ""

                        var tags = (blogPosts[blogPosts.length - i-1].tag1).split(",");
                        var itemTagUl = clone.firstElementChild.childNodes[11]

                        let li = document.createElement("li")
                        li.id = "item-CanItem"
                        itemTagUl.append(li);

                        clone.querySelector("span#author").textContent = blogPosts[blogPosts.length - i-1].author;
                        clone.querySelector("span#date").textContent = blogPosts[blogPosts.length - i-1].date;
                        clone.querySelector("span#title").textContent = blogPosts[blogPosts.length - i-1].title;
                        clone.querySelector("span#description").textContent = blogPosts[blogPosts.length - i-1].description;
                        clone.querySelector("img#item-image").src = blogPosts[blogPosts.length - i-1].coverImage;
                        clone.querySelector("li#item-CanItem").innerHTML = blogPosts[blogPosts.length - i-1].canItem;

                        for(var j = 0; j < tags.length; j++){
                             let li = document.createElement("li")
                             li.textContent = tags[j];
                             li.id = "item-tag-li"
                             itemTagUl.append(li);
                             console.log(tags[j])
                        }
                        
                        gallery[0].appendChild(clone);

                        document.getElementById(cloneId).style.height = "min-content";
                    }
                }
            });
            firebase.firestore().collection('blog-posts').orderBy("likes").get().then((snapshot) => { 

                snapshot.docs.forEach(doc => {
                    blogPosts .push({ ...doc.data() });
                })

                for(let i = 0; i < blogPosts .length; i++){
                    let sugesttions = document.getElementsByClassName('suggestions');
                    let div = document.getElementsByClassName('suggestion-likes');
                    let clone = div[0].cloneNode(true);
                    if(i == 0){
                        document.querySelector("span#suggestion-likes-author").textContent = blogPosts[blogPosts.length-1].author;
                        document.querySelector("span#suggestion-likes-date").textContent = blogPosts[blogPosts.length-1].date;
                        document.querySelector("span#suggestion-likes-title").textContent = blogPosts[blogPosts.length-1].title;
                        document.querySelector("img#suggestion-likes-image").src = blogPosts[blogPosts.length-1].coverImage;

                        var tags = (blogPosts[blogPosts.length-1].tag1).split(",");
                        document.getElementById('suggestion-likes:0').style.height = "min-content";

                    }else if(i == 1){
                        cloneId = "suggestion-likes:" + i;
                        clone.id = cloneId;

                        clone.querySelector("span#suggestion-likes-author").textContent = blogPosts[blogPosts.length - i-1].author;
                        clone.querySelector("span#suggestion-likes-date").textContent = blogPosts[blogPosts.length - i-1].date;
                        clone.querySelector("span#suggestion-likes-title").textContent = blogPosts[blogPosts.length - i-1].title;
                        clone.querySelector("img#suggestion-likes-image").src = blogPosts[blogPosts.length - i-1].coverImage;

                        sugesttions[0].appendChild(clone);
                        document.getElementById(cloneId).style.height = "min-content";
                    }
                    else if(i == 2){
                        cloneId = "suggestion-likes:" + i;
                        clone.id = cloneId;

                        clone.querySelector("span#suggestion-likes-author").textContent = blogPosts[blogPosts.length - i-1].author;
                        clone.querySelector("span#suggestion-likes-date").textContent = blogPosts[blogPosts.length - i-1].date;
                        clone.querySelector("span#suggestion-likes-title").textContent = blogPosts[blogPosts.length - i-1].title;
                        clone.querySelector("img#suggestion-likes-image").src = blogPosts[blogPosts.length - i-1].coverImage;

                        sugesttions[0].appendChild(clone);
                        document.getElementById(cloneId).style.height = "min-content";
                    }
                }

                });
                
            firebase.firestore().collection('blog-posts').orderBy("views").get().then((snapshot) => { 
                $(".suggestions").append("<span>Most Clicked</span><div class='suggestion-views' id ='suggestion-views:0' onClick='reply_click(this.id)'><a ><img id='suggestion-views-image' src='https://picsum.photos/190/190?11' /><span id='suggestion-views-author'>Austin Walter</span><span id='suggestion-views-date'>01.16.2022</span><span id='suggestion-views-title'>This is an Example Title</span></a></div>")
            
                snapshot.docs.forEach(doc => {
                    blogPosts .push({ ...doc.data() });
                })

                for(let i = 0; i < blogPosts .length; i++){
                    let sugesttions = document.getElementsByClassName('suggestions');
                    let div = document.getElementsByClassName('suggestion-views');
                    let clone = div[0].cloneNode(true);
                    if(i == 0){
                        document.querySelector("span#suggestion-views-author").textContent = blogPosts[blogPosts.length-1].author;
                        document.querySelector("span#suggestion-views-date").textContent = blogPosts[blogPosts.length-1].date;
                        document.querySelector("span#suggestion-views-title").textContent = blogPosts[blogPosts.length-1].title;
                        document.querySelector("img#suggestion-views-image").src = blogPosts[blogPosts.length-1].coverImage;

                        var tags = (blogPosts[blogPosts.length-1].tag1).split(",");
                        document.getElementById('suggestion-views:0').style.height = "min-content";

                    }else if(i == 1){
                        cloneId = "suggestion-views:" + i;
                        clone.id = cloneId;

                        clone.querySelector("span#suggestion-views-author").textContent = blogPosts[blogPosts.length - i-1].author;
                        clone.querySelector("span#suggestion-views-date").textContent = blogPosts[blogPosts.length - i-1].date;
                        clone.querySelector("span#suggestion-views-title").textContent = blogPosts[blogPosts.length - i-1].title;
                        clone.querySelector("img#suggestion-views-image").src = blogPosts[blogPosts.length - i-1].coverImage;

                        sugesttions[0].appendChild(clone);
                        document.getElementById(cloneId).style.height = "min-content";
                    }
                    else if(i == 2){
                        cloneId = "suggestion-views:" + i;
                        clone.id = cloneId;

                        clone.querySelector("span#suggestion-views-author").textContent = blogPosts[blogPosts.length - i-1].author;
                        clone.querySelector("span#suggestion-views-date").textContent = blogPosts[blogPosts.length - i-1].date;
                        clone.querySelector("span#suggestion-views-title").textContent = blogPosts[blogPosts.length - i-1].title;
                        clone.querySelector("img#suggestion-views-image").src = blogPosts[blogPosts.length - i-1].coverImage;

                        sugesttions[0].appendChild(clone);
                        document.getElementById(cloneId).style.height = "min-content";
                    }
                }
                });
            document.querySelector("#articleSubmitBtn").addEventListener("click", function(event){
                event.preventDefault();
                const currentDate = new Date();
                var innerDocument = document.getElementById('htmeditor_ifr').contentWindow.document
                
                var inputJson = {
                    title: document.getElementById("inputtitle").value,
                    author: document.getElementById("inputFirstName").value + document.getElementById("inputLastName").value,
                    description: document.getElementById("descriptionTextArea").value,
                    tag1: document.getElementById("inputTag1").value,
                    canItem: document.getElementById("inputCanItem").value,
                    coverImage: document.getElementById("inputCoverImage").value,
                    html: innerDocument.getElementById('tinymce').innerHTML,
                    aproved: true,
                    date:  (currentDate.getMonth() + 1) + "." +  currentDate.getFullYear()
                };
                firebase.firestore().collection("blog-posts").doc((document.getElementById("inputtitle").value.split(" ").join("-"))).set(inputJson)
            });
            function reply_click(id){
                var linkTittle = "http://127.0.0.1:5501/public/template.html?contentId=" + document.getElementById(id).childNodes[1].childNodes[7].innerHTML.trim().split(" ").join("-")
                checkArticleClickedCookie(document.getElementById(id).childNodes[1].childNodes[7].innerHTML.trim().split(" ").join("-"));
                
            }
            function setArticleClickedCookie(cname, exdays) {
                const d = new Date();
                d.setTime(d.getTime() + (exdays*24*60*60*1000));
                let expires = "expires="+ d.toUTCString();
                document.cookie = cname + "=clicked" + ";" + expires + ";path=/";
            }
            function getArticleClickedCookie(cname) {
            let name = cname;
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for(let i = 0; i <ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
                }
            }
            return "";
            }
            function checkArticleClickedCookie(cname) {

                let articleClick = getArticleClickedCookie(cname);
                if (articleClick != "=clicked") {

                    setArticleClickedCookie(cname, 365);
                    firebase.firestore().collection('blog-posts').doc(cname).get().then(function (doc) {
                        if (doc.exists) {
                            var docRef = doc.data()
                            console.log(doc.data())
                            docRef.views = docRef.views+1;
                            firebase.firestore().collection('blog-posts').doc(cname).set(docRef)
                        } else {
                            // doc.data() will be undefined in this case
                            console.log('No such document!');
                        }
                    })
                    .catch(function (error) {
                        console.log('Error getting document:', error);
                    });

                }
            }
        </script>
    </body>
</html>